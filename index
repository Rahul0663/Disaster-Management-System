<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACURESH - Multi-Hazard Disaster Simulator</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- LeafletJS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Chart.js for Data Visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Light grey background */
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease;
        }
        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            color: #4b5563;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .sidebar-link:hover {
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .sidebar-link.active {
            background-color: #eff6ff;
            color: #2563eb;
        }
        .sidebar-link svg {
            margin-right: 0.75rem;
        }
        /* Ensure Leaflet map controls are on top */
        .leaflet-top, .leaflet-bottom {
            z-index: 400 !important;
        }
        .view {
            display: none;
        }
        .view.active {
            display: block;
        }
    </style>
</head>
<body class="text-gray-800">
<!-- Global Alert Banner -->
<div id="broadcastAlert"
     class="hidden fixed top-4 left-1/2 transform -translate-x-1/2 z-50
            bg-red-100 border border-red-400 text-red-800
            px-6 py-3 rounded-lg shadow-lg text-sm font-medium
            transition-all duration-500 ease-in-out opacity-0">
    All NGOs and Volunteers are alerted about the hazard.
</div>

<div class="flex h-screen bg-gray-100">
    <!-- Sidebar -->
    <aside class="w-72 bg-white shadow-lg flex flex-col p-4">
        <div class="flex items-center gap-3 mb-6 p-2">
            <div class="p-2 bg-blue-600 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield-alert"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>
            </div>
            <h1 class="text-xl font-bold text-gray-800">ACURESH</h1>
        </div>

        <nav id="sidebar-nav" class="flex-1 space-y-2">
            <a href="#command-center" class="sidebar-link active" data-view="command-center-view">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                Command Center
            </a>
            <a href="#resources" class="sidebar-link" data-view="resource-view">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 12a2 2 0 1 0-4 0v8a2 2 0 0 0 4 0v-8Z"/><path d="M14 12a2 2 0 1 0-4 0v8a2 2 0 0 0 4 0v-8Z"/><path d="M4 12v8a2 2 0 0 0 4 0v-8a2 2 0 0 0-4 0Z"/><path d="M20 12v8a2 2 0 0 1-4 0v-8a2 2 0 0 1 4 0Z"/><path d="M4 4v.01"/><path d="M8 4v.01"/><path d="M12 4v.01"/><path d="M16 4v.01"/><path d="M20 4v.01"/></svg>
                Resource Coordination
            </a>
            <a href="#missions" class="sidebar-link" data-view="missions-view">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard-check"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="m9 14 2 2 4-4"/></svg>
                Active Missions
            </a>
            <a href="#donations" class="sidebar-link" data-view="donations-view">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 14h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 16"/><path d="m7 20 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.7-2.9l-4.2 4.3c-.2.2-.5.2-.7 0L9 12.4s-1.5-1.4-2.5-2.4c-1-1-1.5-2.5-1.5-2.5S3 6 5 6h2"/><path d="M18 15a2.5 2.5 0 0 0-2.5-2.5c-.3 0-.5.2-.5.5v2c0 .3.2.5.5.5A2.5 2.5 0 0 0 18 15Z"/></svg>
                Relief Donations
            </a>
            <a href="#voice-alerts" class="sidebar-link" data-view="alerts-view">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 11 18-5v12L3 14v-3z"/><path d="M11.6 16.8a3 3 0 0 1-5.8-1.6H3"/></svg>
                Voice Alerts
            </a>
            <a href="#analytics" class="sidebar-link" data-view="analytics-view">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18.7 8a6 6 0 0 0-8.3-8.3"/><path d="M18.7 18a6 6 0 0 0-8.3-8.3"/></svg>
                Analytics & Performance
            </a>
        </nav>

        <div class="mt-auto">
            <div class="text-sm text-gray-500 p-2">&copy; 2025 Acuresh Initiative.</div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto">
        <!-- Command Center View -->
        <div id="command-center-view" class="view active p-6">
            <header class="flex justify-between items-center mb-6">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Command Center</h1>
                    <p class="text-gray-600">Real-time hazard simulation and response dashboard for Punjab.</p>
                </div>
                <div id="live-clock" class="text-right">
                    <p class="font-semibold text-xl text-gray-800"></p>
                    <p class="text-sm text-gray-500"></p>
                </div>
            </header>
            <!-- KPIs -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="card p-5"><p class="text-sm text-gray-500">Avg. Response Time</p><p class="text-2xl font-bold">15 Min</p></div>
                <div class="card p-5"><p class="text-sm text-gray-500">Citizens Reached</p><p class="text-2xl font-bold">1.2M</p></div>
                <div class="card p-5"><p class="text-sm text-gray-500">Relief Funding</p><p class="text-2xl font-bold">â‚¹2.0Cr</p></div>
                <div class="card p-5"><p class="text-sm text-gray-500">Verified Orgs</p><p id="kpi-ngos" class="text-2xl font-bold">25</p></div>
            </div>
            <!-- Main view: Map and Right Column -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-[65vh]">
                <div class="lg:col-span-2 card p-2">
                    <div id="map" class="h-full w-full rounded-md"></div>
                </div>
                <div class="flex flex-col gap-6">
                    <div class="card p-4">
                        <h3 class="font-semibold text-lg mb-2">Simulation Controls</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="hazard-type" class="block text-sm font-medium text-gray-700 mb-1">Hazard Type</label>
                                <select id="hazard-type" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                    <option value="all">All Hazards</option> <option value="Flood">Flood</option> <option value="Heatwave">Heatwave</option> <option value="Fire">Fire</option>
                                </select>
                            </div>
                            <div>
                                <label for="location-filter" class="block text-sm font-medium text-gray-700 mb-1">Focus Location</label>
                                <select id="location-filter" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                    <option value="all">All Punjab</option> <option value="Chandigarh">Chandigarh</option> <option value="Ludhiana">Ludhiana</option> <option value="Amritsar">Amritsar</option> <option value="Patiala">Patiala</option> <option value="Mohali">Mohali</option> <option value="Hoshiarpur">Hoshiarpur</option> <option value="Bathinda">Bathinda</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div id="weather-forecast-card" class="card p-4">
                        <!-- Weather content will be injected here -->
                    </div>
                    <div class="card p-4 flex-1">
                        <h3 class="font-semibold text-lg mb-2">Shelter Capacity</h3>
                        <div class="space-y-3">
                            <div>
                                <div class="flex justify-between text-sm mb-1"><span>Sector 11 College</span><span>85%</span></div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-red-500 h-2.5 rounded-full" style="width: 85%"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm mb-1"><span>Ludhiana Arena</span><span>40%</span></div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-green-500 h-2.5 rounded-full" style="width: 40%"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm mb-1"><span>Patiala Center</span><span>60%</span></div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-yellow-500 h-2.5 rounded-full" style="width: 60%"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resource Coordination View -->
        <!-- Resource Coordination View -->
        <div id="resource-view" class="view p-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">Resource Coordination</h1>

            <!-- Active Resources Summary -->
            <div class="card p-4 bg-white shadow-md rounded-2xl mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-semibold text-lg text-gray-800">Active Resources</h3>
                    <span id="totalResources" class="text-sm text-gray-600">Loading...</span>
                </div>
                <div id="resourceSummary"
                     class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-3"></div>
            </div>

            <!-- Resource Table -->
            <div class="card p-4 bg-white shadow-md rounded-2xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-semibold text-lg text-gray-800">Available Resources & Equipment</h3>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="filterAvailable"
                               class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="filterAvailable" class="text-sm text-gray-700 select-none cursor-pointer">
                            Show Available Only
                        </label>
                    </div>
                </div>

                <!-- Filters -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                    <input id="filterCity" type="text" placeholder="Search by City"
                           class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input id="filterType" type="text" placeholder="Search by Resource Type"
                           class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input id="filterLocation" type="text" placeholder="Search by Location"
                           class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <!-- Table -->
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm" id="resourceTable">
                        <thead class="bg-gray-50 text-gray-600">
                        <tr id="tableHeader"></tr>
                        </thead>
                        <tbody id="tableBody" class="divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Include PapaParse -->

        <!-- Active Missions View -->
        <div id="missions-view" class="view p-6">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-gray-900">Active Missions</h1>
                <button class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-700 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    Create New Mission
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Mission Card 1: Critical -->
                <div class="card p-4 border-l-4 border-red-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-bold text-lg">Flood Rescue - Patiala</p>
                            <p class="text-sm text-gray-500">Assigned: Team Alpha, Team Bravo</p>
                        </div>
                        <span class="text-xs font-bold px-2 py-1 bg-red-100 text-red-700 rounded-full">CRITICAL</span>
                    </div>
                    <div class="mt-4">
                        <div class="flex justify-between text-sm mb-1"><span>Progress</span><span>60%</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-red-500 h-2.5 rounded-full" style="width: 60%"></div></div>
                    </div>
                    <div class="mt-4 pt-2 border-t flex justify-end gap-2">
                        <button class="text-sm bg-gray-200 text-gray-800 font-semibold py-1 px-3 rounded-md hover:bg-gray-300">Assign Team</button>
                        <button class="text-sm bg-blue-100 text-blue-700 font-semibold py-1 px-3 rounded-md hover:bg-blue-200">View Details</button>
                    </div>
                </div>

                <!-- Mission Card 2: High -->
                <div class="card p-4 border-l-4 border-orange-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-bold text-lg">Medical Supply Run</p>
                            <p class="text-sm text-gray-500">Assigned: Medical Corps</p>
                        </div>
                        <span class="text-xs font-bold px-2 py-1 bg-orange-100 text-orange-700 rounded-full">HIGH</span>
                    </div>
                    <div class="mt-4">
                        <div class="flex justify-between text-sm mb-1"><span>Progress</span><span>25%</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-orange-500 h-2.5 rounded-full" style="width: 25%"></div></div>
                    </div>
                    <div class="mt-4 pt-2 border-t flex justify-end gap-2">
                        <button class="text-sm bg-gray-200 text-gray-800 font-semibold py-1 px-3 rounded-md hover:bg-gray-300">Assign Team</button>
                        <button class="text-sm bg-blue-100 text-blue-700 font-semibold py-1 px-3 rounded-md hover:bg-blue-200">View Details</button>
                    </div>
                </div>

                <!-- Mission Card 3: Pending -->
                <div class="card p-4 border-l-4 border-gray-400">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-bold text-lg">Shelter Setup - Ludhiana</p>
                            <p class="text-sm text-gray-500">Assigned: Unassigned</p>
                        </div>
                        <span class="text-xs font-bold px-2 py-1 bg-gray-100 text-gray-700 rounded-full">PENDING</span>
                    </div>
                    <div class="mt-4">
                        <div class="flex justify-between text-sm mb-1"><span>Progress</span><span>0%</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-gray-400 h-2.5 rounded-full" style="width: 0%"></div></div>
                    </div>
                    <div class="mt-4 pt-2 border-t flex justify-end gap-2">
                        <button class="text-sm bg-blue-600 text-white font-semibold py-1 px-3 rounded-md hover:bg-blue-700">Assign Team</button>
                        <button class="text-sm bg-blue-100 text-blue-700 font-semibold py-1 px-3 rounded-md hover:bg-blue-200">View Details</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Donations View -->
        <div id="donations-view" class="view p-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">Relief Donations</h1>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="card p-5 text-center"><p class="text-3xl font-bold text-blue-600">1,500+</p><p class="text-gray-500">Families Helped</p></div>
                <div class="card p-5 text-center"><p class="text-3xl font-bold text-blue-600">10,000+</p><p class="text-gray-500">Relief Packages</p></div>
                <div class="card p-5 text-center"><p class="text-3xl font-bold text-blue-600">â‚¹2.0Cr</p><p class="text-gray-500">Total Raised</p></div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card p-4">
                    <h3 class="font-semibold text-lg mb-4">Active Relief Campaigns</h3>
                    <div class="space-y-4">
                        <div>
                            <p class="font-semibold">Punjab Flood Relief</p>
                            <div class="flex justify-between text-sm"><span class="text-gray-600">Raised â‚¹1.5Cr of â‚¹2.0Cr</span><span>75%</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-blue-600 h-2.5 rounded-full" style="width: 75%"></div></div>
                        </div>
                        <div>
                            <p class="font-semibold">Ludhiana Fire Support</p>
                            <div class="flex justify-between text-sm"><span class="text-gray-600">Raised â‚¹40L of â‚¹50L</span><span>80%</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-blue-600 h-2.5 rounded-full" style="width: 80%"></div></div>
                        </div>
                    </div>
                </div>
                <div class="card p-4">
                    <h3 class="font-semibold text-lg mb-4">Recent Donations</h3>
                    <ul class="space-y-2 text-sm">
                        <li class="flex justify-between"><span>Anonymous</span><span class="font-semibold text-green-600">â‚¹5,000</span></li>
                        <li class="flex justify-between"><span>R. Sharma</span><span class="font-semibold text-green-600">â‚¹10,000</span></li>
                        <li class="flex justify-between"><span>SK Industries</span><span class="font-semibold text-green-600">â‚¹1,00,000</span></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Voice Alerts View -->
        <div id="alerts-view" class="view p-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">Voice Alert Broadcasting System</h1>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card p-6">
                    <h3 class="font-semibold text-lg mb-4">New Broadcast</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Hazard Type</label>
                            <select id="alert-hazard-type"
                                    class="w-full p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
                                <option>Flood</option>
                                <option>Fire</option>
                                <option>Heatwave</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-1">City</label>
                            <select id="alert-city-select"
                                    class="w-full p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
                                <option value="All Punjab">All Punjab</option>
                                <option value="Chandigarh">Chandigarh</option>
                                <option value="Ludhiana">Ludhiana</option>
                                <option value="Amritsar">Amritsar</option>
                                <option value="Patiala">Patiala</option>
                                <option value="Mohali">Mohali</option>
                                <option value="Hoshiarpur">Hoshiarpur</option>
                                <option value="Bathinda">Bathinda</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-1">Language</label>
                            <select id="voice-lang-select"
                                    class="w-full p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
                                <option value="pa-IN">Punjabi</option>
                                <option value="hi-IN">Hindi</option>
                                <option value="en-US">English</option>
                            </select>
                        </div>
                        <div><label class="block text-sm font-medium">Broadcast Channel</label><div class="flex gap-4"><label><input type="checkbox" checked> IVR</label><label><input type="checkbox" checked> WhatsApp</label><label><input type="checkbox"> FM</label></div></div>
                        <div><label class="block text-sm font-medium">Custom Alert Message</label><textarea id="alert-message-textarea" class="w-full p-2 border rounded-md" rows="3">Emergency Alert: A critical hazard has been detected in your area. Please follow instructions from authorities immediately.</textarea></div>
                        <div class="flex gap-4">
                            <button id="start-broadcast-btn" class="w-full bg-blue-600 text-white font-semibold py-2 rounded-md">Start Broadcast</button>
                            <button id="preview-broadcast-btn" class="w-full bg-gray-200 font-semibold py-2 rounded-md">Preview</button>
                        </div>
                    </div>
                </div>
                <div class="space-y-6">
                    <div class="card p-4">
                        <h3 class="font-semibold">Active Broadcast</h3>
                        <p>Total Recipients: <span class="font-bold">1,250,432</span></p>
                    </div>
                    <div id="safety-precautions-card" class="card p-4">
                        <!-- Safety precautions will be injected here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics View -->
        <div id="analytics-view" class="view p-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">Analytics & System Performance</h1>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="card p-4"><h3 class="font-semibold mb-2">Response Time (Minutes)</h3><canvas id="responseTimeChart"></canvas></div>
                <div class="card p-4"><h3 class="font-semibold mb-2">Hazard Breakdown</h3><canvas id="hazardDistributionChart"></canvas></div>
                <div class="card p-4"><h3 class="font-semibold mb-2">Donation Growth (Last 6 Days)</h3><canvas id="donationTrendChart"></canvas></div>
                <div class="lg:col-span-3 card p-4"><h3 class="font-semibold mb-2">System Performance</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                        <div><p class="text-2xl font-bold text-green-600">98.5%</p><p class="text-sm text-gray-500">AI Model Accuracy</p></div>
                        <div><p class="text-2xl font-bold text-green-600">99.99%</p><p class="text-sm text-gray-500">API Uptime</p></div>
                        <div><p class="text-2xl font-bold text-green-600">120ms</p><p class="text-sm text-gray-500">Response Latency</p></div>
                        <div><p class="text-2xl font-bold text-green-600">30s</p><p class="text-sm text-gray-500">Data Sync</p></div>
                    </div>
                </div>
            </div>
        </div>

    </main>
</div>

<!-- Main Application Logic -->
<script>
    const patientData = [
      { "Patient_ID": "P0001", "Name": "Brooke", "Age": 53, "Gender": "F", "Location": "Patiala", "Date": "2025-10-01", "Temperature_C": 15.7, "Humidity_%": 83.3, "Rainfall_mm": 115.2, "AQI": 123, "Weather_Event": "Flood", "Health_Issue": "Waterborne disease", "Severity": "Moderate", "Hospital_Visited": "Yes", "Recovery_Time_Days": 9 },
      { "Patient_ID": "P0007", "Name": "Michael", "Age": 21, "Gender": "F", "Location": "Patiala", "Date": "2025-10-01", "Temperature_C": 39.5, "Humidity_%": 45.4, "Rainfall_mm": 1, "AQI": 145, "Weather_Event": "Heatwave", "Health_Issue": "Heatstroke", "Severity": "Severe", "Hospital_Visited": "Yes", "Recovery_Time_Days": 5 },
      { "Patient_ID": "P0008", "Name": "Tammy", "Age": 57, "Gender": "M", "Location": "Ludhiana", "Date": "2025-10-03", "Temperature_C": 18.5, "Humidity_%": 98.3, "Rainfall_mm": 172.9, "AQI": 130, "Weather_Event": "Flood", "Health_Issue": "Infection", "Severity": "Moderate", "Hospital_Visited": "Yes", "Recovery_Time_Days": 12 },
      { "Patient_ID": "P1001", "Name": "Aarav", "Age": 45, "Gender": "M", "Location": "Ludhiana", "Date": "2025-10-10", "Temperature_C": 38.0, "Humidity_%": 25.0, "Rainfall_mm": 0, "AQI": 250, "Weather_Event": "Fire", "Health_Issue": "Burns", "Severity": "Severe", "Hospital_Visited": "Yes", "Recovery_Time_Days": 20 },
    ];

    document.addEventListener('DOMContentLoaded', () => {

        // --- MAP & LAYERS ---
        const map = L.map('map').setView([30.7333, 76.7794], 9);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
        }).addTo(map);

        const hazardLayers = L.layerGroup().addTo(map);
        const shelterLayer = L.layerGroup().addTo(map);
        const teamsLayer = L.layerGroup().addTo(map);

        const overlayMaps = {
            "Hazard Zones": hazardLayers,
            "Shelters": shelterLayer,
            "Response Teams": teamsLayer
        };
        L.control.layers(null, overlayMaps, { collapsed: false }).addTo(map);

        // --- UI ELEMENTS ---
        const hazardSelect = document.getElementById('hazard-type');
        const locationSelect = document.getElementById('location-filter');
        const alertHazardSelect = document.getElementById('alert-hazard-type');

        // --- DATA & STATE ---
        let responseTimeChart, hazardDistributionChart, donationTrendChart;

        const cityCoordinates = {
            'Chandigarh': [30.7333, 76.7794], 'Ludhiana': [30.9010, 75.8573], 'Amritsar': [31.6340, 74.8723],
            'Patiala': [30.3398, 76.3869], 'Mohali': [30.7046, 76.7179], 'Hoshiarpur': [31.5300, 75.9100], 'Bathinda': [30.2110, 74.9455]
        };

        const weatherData = {
            'all': { current: { temp: 31, desc: "Sunny", icon: 'â˜€' }, forecast: [ { day: 'Fri', temp: 32, icon: 'â˜€' }, { day: 'Sat', temp: 30, icon: 'â˜' }, { day: 'Sun', temp: 28, icon: 'ðŸŒ¦' }, { day: 'Mon', temp: 29, icon: 'â˜€' }, { day: 'Tue', temp: 31, icon: 'â˜€' } ] },
            'Chandigarh': { current: { temp: 32, desc: "Clear", icon: 'â˜€' }, forecast: [ { day: 'Fri', temp: 33, icon: 'â˜€' }, { day: 'Sat', temp: 31, icon: 'â˜' }, { day: 'Sun', temp: 29, icon: 'ðŸŒ¦' }, { day: 'Mon', temp: 30, icon: 'â˜€' }, { day: 'Tue', temp: 32, icon: 'â˜€' } ] },
            'Ludhiana': { current: { temp: 34, desc: "Hazy Sun", icon: 'ðŸŒ¤' }, forecast: [ { day: 'Fri', temp: 35, icon: 'â˜€' }, { day: 'Sat', temp: 33, icon: 'ðŸŒ¤' }, { day: 'Sun', temp: 30, icon: 'â˜' }, { day: 'Mon', temp: 31, icon: 'ðŸŒ¤' }, { day: 'Tue', temp: 33, icon: 'â˜€' } ] },
            'Amritsar': { current: { temp: 33, desc: "Sunny", icon: 'â˜€' }, forecast: [ { day: 'Fri', temp: 34, icon: 'â˜€' }, { day: 'Sat', temp: 32, icon: 'â˜€' }, { day: 'Sun', temp: 30, icon: 'â˜' }, { day: 'Mon', temp: 31, icon: 'â˜€' }, { day: 'Tue', temp: 33, icon: 'â˜€' } ] },
            'Patiala': { current: { temp: 28, desc: "Rain", icon: 'ðŸŒ§' }, forecast: [ { day: 'Fri', temp: 29, icon: 'ðŸŒ§' }, { day: 'Sat', temp: 27, icon: 'ðŸŒ§' }, { day: 'Sun', temp: 26, icon: 'ðŸŒ¦' }, { day: 'Mon', temp: 28, icon: 'â˜' }, { day: 'Tue', temp: 30, icon: 'ðŸŒ¤' } ] },
            'Mohali': { current: { temp: 32, desc: "Clear", icon: 'â˜€' }, forecast: [ { day: 'Fri', temp: 33, icon: 'â˜€' }, { day: 'Sat', temp: 31, icon: 'â˜' }, { day: 'Sun', temp: 29, icon: 'ðŸŒ¦' }, { day: 'Mon', temp: 30, icon: 'â˜€' }, { day: 'Tue', temp: 32, icon: 'â˜€' } ] },
            'Hoshiarpur': { current: { temp: 30, desc: "Cloudy", icon: 'â˜' }, forecast: [ { day: 'Fri', temp: 31, icon: 'â˜' }, { day: 'Sat', temp: 29, icon: 'ðŸŒ¦' }, { day: 'Sun', temp: 28, icon: 'ðŸŒ¦' }, { day: 'Mon', temp: 29, icon: 'â˜' }, { day: 'Tue', temp: 30, icon: 'ðŸŒ¤' } ] },
            'Bathinda': { current: { temp: 35, desc: "Hot", icon: 'â˜€' }, forecast: [ { day: 'Fri', temp: 36, icon: 'â˜€' }, { day: 'Sat', temp: 34, icon: 'â˜€' }, { day: 'Sun', temp: 32, icon: 'ðŸŒ¤' }, { day: 'Mon', temp: 33, icon: 'â˜€' }, { day: 'Tue', temp: 35, icon: 'â˜€' } ] },
        };

        const safetyPrecautions = {
            'Flood': {
                before: 'Prepare an emergency kit. Know your evacuation routes. Secure your property.',
                during: 'Move to higher ground. Avoid walking or driving through floodwaters. Listen to emergency alerts.',
                after: 'Avoid returning home until authorities say it is safe. Be aware of contamination. Clean and disinfect everything.'
            },
            'Fire': {
                before: 'Create a defensible space around your home. Have a fire extinguisher and know how to use it. Plan your escape routes.',
                during: 'Evacuate immediately if told to do so. Cover your mouth and nose. Stay low to the ground.',
                after: 'Check for embers and hidden fires. Be cautious of structural damage. Listen to news reports for updates.'
            },
            'Heatwave': {
                before: 'Insulate your home. Check your air conditioning system. Know where to find cooling centers.',
                during: 'Stay indoors in a cool place. Drink plenty of water. Wear lightweight clothing.',
                after: 'Continue to stay hydrated. Check on vulnerable neighbors. Watch for signs of heat-related illness.'
            }
        };

        // --- FUNCTIONS ---
        function updateDashboard() {
            const selectedHazard = hazardSelect.value;
            const selectedLocation = locationSelect.value;

            const filteredData = patientData.filter(d => {
                const hazardMatch = selectedHazard === 'all' || d.Weather_Event === selectedHazard;
                const locationMatch = selectedLocation === 'all' || d.Location === selectedLocation;
                return hazardMatch && locationMatch;
            });

            updateMap(filteredData, selectedHazard, selectedLocation);
            updateWeatherForecast(selectedLocation);
        }

        function updateMap(data, hazard, location) {
            hazardLayers.clearLayers();

            if(location !== 'all' && cityCoordinates[location]){ map.setView(cityCoordinates[location], 12); }
            else { map.setView([30.97, 75.95], 9); }

            if (hazard === 'Flood' || hazard === 'all') drawFloodZones();
            if (hazard === 'Heatwave' || hazard === 'all') drawHeatwaveZones();
            if (hazard === 'Fire' || hazard === 'all') drawFireZones();
        }

        function updateWeatherForecast(location) {
            const forecastContainer = document.getElementById('weather-forecast-card');
            const data = weatherData[location] || weatherData['all'];
            let forecastHtml = `
                <h3 class="font-semibold text-lg mb-2">Weather Forecast</h3>
                <div class="flex items-center justify-between p-2 bg-blue-50 rounded-lg">
                    <div>
                        <p class="text-gray-600 text-sm">Now in ${location === 'all' ? 'Punjab' : location}</p>
                        <p class="font-bold text-2xl">${data.current.temp}Â°C</p>
                        <p class="text-sm text-gray-500">${data.current.desc}</p>
                    </div>
                    <div class="text-5xl">${data.current.icon}</div>
                </div>
                <div class="mt-4 grid grid-cols-5 gap-2 text-center">
            `;
            data.forecast.forEach(day => {
                forecastHtml += `
                    <div class="p-1 bg-gray-50 rounded-md">
                        <p class="font-semibold text-sm">${day.day}</p>
                        <p class="text-2xl">${day.icon}</p>
                        <p class="text-sm text-gray-600">${day.temp}Â°C</p>
                    </div>
                `;
            });
            forecastHtml += '</div>';
            forecastContainer.innerHTML = forecastHtml;
        }

        function updateSafetyPrecautions(hazard) {
            const precautionsContainer = document.getElementById('safety-precautions-card');
            const data = safetyPrecautions[hazard];
            if (!data) return;

            precautionsContainer.innerHTML = `
                <h3 class="font-semibold text-lg mb-2">Safety Precautions: ${hazard}</h3>
                <div class="text-sm space-y-3">
                    <div>
                        <h4 class="font-semibold text-gray-700">Before</h4>
                        <p class="text-gray-600">${data.before}</p>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-700">During</h4>
                        <p class="text-gray-600">${data.during}</p>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-700">After</h4>
                        <p class="text-gray-600">${data.after}</p>
                    </div>
                </div>
            `;
        }

        function drawFloodZones(){
            L.polygon([[31.05, 76.4], [31.2, 75.8], [30.8, 75.5]], { color: '#0ea5e9', fillColor: '#0ea5e9', weight: 2, fillOpacity: 0.4 }).addTo(hazardLayers);
        }
        function drawHeatwaveZones(){
            L.circle([30.2110, 74.9455], { radius: 50000, color: '#f97316', fillColor: '#f97316', weight: 2, fillOpacity: 0.3 }).addTo(hazardLayers);
        }
        function drawFireZones() {
            L.circle([30.9010, 75.8573], { radius: 15000, color: '#dc2626', fillColor: '#dc2626', weight: 2, fillOpacity: 0.4 }).addTo(hazardLayers);
        }
        function showHazardOnMap(city, hazard) {
  if (!cityCoordinates[city]) {
    alert("City not found on map.");
    return;
  }

  const coord = cityCoordinates[city];
  map.setView(coord, 12);

  // Clear previous markers/zones
  hazardLayers.clearLayers();

  // Add marker for broadcast city
  const marker = L.marker(coord)
    .bindPopup(`<b>${hazard} Alert</b><br>${city}`)
    .addTo(hazardLayers)
    .openPopup();

  // Draw hazard zone visualization
  let color = '#3b82f6';
  if (hazard === 'Flood') color = '#0ea5e9';
  if (hazard === 'Fire') color = '#dc2626';
  if (hazard === 'Heatwave') color = '#f97316';

  L.circle(coord, {
    radius: 20000,
    color,
    fillColor: color,
    weight: 2,
    fillOpacity: 0.3
  }).addTo(hazardLayers);
}
function showBroadcastAlert(hazard, city) {
  const alertBox = document.getElementById("broadcastAlert");
  if (!alertBox) return;

  // Dynamic text
  alertBox.textContent = `All NGOs and Volunteers are alerted about ${hazard.toLowerCase()} in ${city}.`;

  // Hazard-specific color theme
  let bg = "bg-green-100 border-green-400 text-green-800";
  if (hazard === "Flood") bg = "bg-blue-100 border-blue-400 text-blue-800";
  if (hazard === "Fire") bg = "bg-red-100 border-red-400 text-red-800";
  if (hazard === "Heatwave") bg = "bg-orange-100 border-orange-400 text-orange-800";

  alertBox.className = `fixed top-4 left-1/2 transform -translate-x-1/2 z-50
    px-6 py-3 rounded-lg shadow-lg text-sm font-medium transition-all duration-500
    ease-in-out opacity-0 ${bg}`;

  // Show animation
  alertBox.classList.remove("hidden");
  setTimeout(() => alertBox.classList.add("opacity-100"), 10);

  // Hide after 5 seconds
  setTimeout(() => {
    alertBox.classList.remove("opacity-100");
    setTimeout(() => alertBox.classList.add("hidden"), 500);
  }, 5000);
}


        function drawStaticLayers() {
             L.marker([30.7415, 76.7641]).bindPopup("<b>Safe Shelter</b><br>Govt. College Sector 11").addTo(shelterLayer);
             L.marker([30.92, 75.81]).bindPopup("<b>Response Team Alpha</b><br>Status: On Site").addTo(teamsLayer);
        }

        function createAnalyticsCharts() {
            if (responseTimeChart) responseTimeChart.destroy();
            responseTimeChart = new Chart(document.getElementById('responseTimeChart'), {
                type: 'bar', data: { labels: ['Traditional', 'ACURESH'], datasets: [{ label: 'Time in minutes', data: [120, 15], backgroundColor: ['#f87171', '#60a5fa']}] },
                options: { indexAxis: 'y', plugins: { legend: { display: false } } }
            });

            if (hazardDistributionChart) hazardDistributionChart.destroy();
            hazardDistributionChart = new Chart(document.getElementById('hazardDistributionChart'), {
                type: 'pie', data: { labels: ['Flood', 'Fire', 'Health', 'Heatwave'], datasets: [{ data: [40, 25, 15, 20], backgroundColor: ['#3b82f6', '#ef4444', '#10b981', '#f97316']}] },
                options: { plugins: { legend: { position: 'bottom' } } }
            });

            if (donationTrendChart) donationTrendChart.destroy();
            donationTrendChart = new Chart(document.getElementById('donationTrendChart'), {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6'],
                    datasets: [{ label: 'Lakhs INR', data: [10, 25, 40, 80, 120, 200], fill: false, borderColor: '#3b82f6', tension: 0.1 }]
                },
                options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
            });
        }

        function setupViewSwitcher() {
            const navLinks = document.querySelectorAll('#sidebar-nav .sidebar-link');
            const views = document.querySelectorAll('.view');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetViewId = link.getAttribute('data-view');

                    navLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');

                    views.forEach(view => {
                        view.classList.remove('active');
                        if (view.id === targetViewId) {
                            view.classList.add('active');
                        }
                    });
                     if(targetViewId === 'analytics-view') {
                        createAnalyticsCharts();
                     }
                     // Invalidate map size when switching to command center to fix gray tile issue
                     if (targetViewId === 'command-center-view') {
                        setTimeout(() => map.invalidateSize(), 10);
                     }
                });
            });
        }

        function updateClock() {
            const now = new Date();
            const timeEl = document.querySelector("#live-clock p:first-child");
            const dateEl = document.querySelector("#live-clock p:last-child");
            if(timeEl && dateEl){
                timeEl.textContent = now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', second: '2-digit', timeZone: 'Asia/Kolkata' });
                dateEl.textContent = now.toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', timeZone: 'Asia/Kolkata' });
            }
        }
        setInterval(updateClock, 1000);

        function speakAlert() {
  const message = document.getElementById('alert-message-textarea').value;
  const lang = document.getElementById('voice-lang-select').value;
  const city = document.getElementById('alert-city-select').value;
  const hazard = document.getElementById('alert-hazard-type').value;

  const finalMessage = `ðŸš¨ ${hazard} Alert for ${city}: ${message}`;

  // --- Voice Broadcast ---
  if ('speechSynthesis' in window) {
    const utterance = new SpeechSynthesisUtterance(finalMessage);
    utterance.lang = lang;
    speechSynthesis.speak(utterance);
  } else {
    alert('Sorry, your browser does not support text-to-speech.');
  }

  // --- Reflect on Command Center Map ---
  showHazardOnMap(city, hazard);

  // --- Switch to Command Center Tab ---
  const navLinks = document.querySelectorAll('#sidebar-nav .sidebar-link');
  navLinks.forEach(link => {
    if (link.getAttribute('data-view') === 'command-center-view') {
      link.click();
    }
  });

  // --- Show Dynamic Broadcast Alert ---
  showBroadcastAlert(hazard, city);
}




        // --- EVENT LISTENERS ---
        hazardSelect.addEventListener('change', updateDashboard);
        locationSelect.addEventListener('change', updateDashboard);
        document.getElementById('start-broadcast-btn').addEventListener('click', speakAlert);
        document.getElementById('preview-broadcast-btn').addEventListener('click', speakAlert);
        alertHazardSelect.addEventListener('change', (e) => updateSafetyPrecautions(e.target.value));


        // --- INITIAL LOAD ---
        updateDashboard();
        updateClock();
        drawStaticLayers();
        setupViewSwitcher();
        updateSafetyPrecautions(alertHazardSelect.value);
    });




    document.addEventListener("DOMContentLoaded", () => {
      const csvPath = "./disaster_resources_dataset.csv";
      const tableHeader = document.getElementById("tableHeader");
      const tableBody = document.getElementById("tableBody");
      const filterAvailable = document.getElementById("filterAvailable");
      const filterCity = document.getElementById("filterCity");
      const filterType = document.getElementById("filterType");
      const filterLocation = document.getElementById("filterLocation");
      const resourceSummary = document.getElementById("resourceSummary");
      const totalResourcesEl = document.getElementById("totalResources");

      let fullData = [];
      let currentFiltered = [];

      function renderTable(data) {
        tableBody.innerHTML = "";
        data.forEach(row => {
          const tr = document.createElement("tr");
          tr.className = "border-b hover:bg-gray-50 transition";
          Object.entries(row).forEach(([key, val]) => {
            const td = document.createElement("td");
            td.className = "p-2 text-gray-700";
            if (key.toLowerCase() === "availability") {
              const span = document.createElement("span");
              span.className =
                `px-2 py-1 rounded-full text-xs font-medium ${ (val || "").toLowerCase() === "yes"
                  ? "bg-green-100 text-green-700"
                  : "bg-red-100 text-red-700"}`;
              span.textContent = val || "No";
              td.appendChild(span);
            } else td.textContent = val;
            tr.appendChild(td);
          });
          const actionTd = document.createElement("td");
          actionTd.className = "p-2 text-center";
          const button = document.createElement("button");
          button.className = "text-sm font-semibold rounded px-3 py-1 transition";
          if ((row.Availability || "").toLowerCase() === "yes") {
            button.classList.add("text-blue-600", "hover:text-blue-800");
            button.textContent = "Deploy";
          } else {
            button.classList.add("text-gray-400");
            button.textContent = "Unavailable";
          }
          actionTd.appendChild(button);
          tr.appendChild(actionTd);
          tableBody.appendChild(tr);
        });
      }

      function updateActiveResourcesSummary(filteredData = fullData) {
  if (!filteredData.length) {
    totalResourcesEl.textContent = "No data available";
    resourceSummary.innerHTML = "";
    return;
  }

  const available = filteredData.filter(
    (r) => (r.Availability || "").trim().toLowerCase() === "yes"
  );

  const typeTotals = {};
  available.forEach((r) => {
    const type = r.Resource_Type || r["Resource_Type"] || r.Type || "Unknown";
    const qty = parseInt(r.Quantity || 0);
    typeTotals[type] = (typeTotals[type] || 0) + (isNaN(qty) ? 0 : qty);
  });

  totalResourcesEl.textContent = `Total Available: ${available.length}`;
  resourceSummary.innerHTML = "";

  Object.entries(typeTotals).forEach(([type, qty]) => {
    const div = document.createElement("div");
    div.className =
      "bg-blue-50 border border-blue-200 rounded-lg p-3 flex flex-col items-center text-center shadow-sm hover:bg-blue-100 transition cursor-pointer";
    div.innerHTML = `
      <h4 class="text-xs font-semibold text-gray-700 truncate w-full">${type}</h4>
      <p class="text-blue-700 font-bold text-base mt-1">${qty}</p>
    `;
if (filterType.value === type) {
  div.classList.add("border-blue-500", "bg-blue-100");
}

    // Toggle logic: remember last clicked type
    div.addEventListener("click", () => {
      if (filterType.value === type) {
        // if same card clicked again â€” clear filters
        filterType.value = "";
        filterCity.value = "";
        filterLocation.value = "";
        filterAvailable.checked = false;
      } else {
        // otherwise filter by that type
        filterType.value = type;
      }

      applyFilters();
      window.scrollTo({ top: tableBody.offsetTop - 100, behavior: "smooth" });
    });

    resourceSummary.appendChild(div);
  });
}


      function applyFilters() {
        let filtered = [...fullData];
        if (filterAvailable.checked)
          filtered = filtered.filter(r => (r.Availability || "").trim().toLowerCase() === "yes");

        const cityValue = (filterCity.value || "").toLowerCase();
        const typeValue = (filterType.value || "").toLowerCase();
        const locationValue = (filterLocation.value || "").toLowerCase();

        filtered = filtered.filter(r =>
          (!cityValue || (r.City || "").toLowerCase().includes(cityValue)) &&
          (!typeValue || (r.Resource_Type || "").toLowerCase().includes(typeValue)) &&
          (!locationValue || (r.Location || "").toLowerCase().includes(locationValue))
        );

        currentFiltered = filtered;
        renderTable(filtered);
        updateActiveResourcesSummary(filtered);
      }

      Papa.parse(csvPath, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: results => {
          fullData = results.data || [];
          if (!fullData.length) return;
          tableHeader.innerHTML = "";
          Object.keys(fullData[0]).forEach(col => {
            const th = document.createElement("th");
            th.className = "p-2 font-semibold";
            th.textContent = col;
            tableHeader.appendChild(th);
          });
          const actionTh = document.createElement("th");
          actionTh.className = "p-2 font-semibold";
          actionTh.textContent = "Actions";
          tableHeader.appendChild(actionTh);
          currentFiltered = fullData;
          renderTable(fullData);
          updateActiveResourcesSummary(fullData);
        },
        error: err => console.error("CSV load error:", err)
      });

      [filterAvailable, filterCity, filterType, filterLocation].forEach(el =>
        el.addEventListener("input", applyFilters)
      );
    });

</script>
</body>
</html>
